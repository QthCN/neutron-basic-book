## 内核网络相关基础知识

这一章主要是为了后面关于协议栈的章节做准备的，内容包括：

- sk_buff数据结构
- net_device数据结构
- 硬件中断
- softirq
- proc文件系统

关于这些方面的小秦所发现的最好的参考资料是《Understanding Linux Network Internals》。强烈建议每个对Linux内核中网络有兴趣的同学读下这本书。

### sk_buff数据结构

sk_buff在内核的地位简单的说就是：它代表了一个数据包。

首先来个大致的介绍让大家感受下它的作用吧。比如一个网卡收到了一个包，此时大家可以认为这个数据包对于网卡来说只是一段电信号或光信号，网卡收到这个包后，会先保存在网卡本地，然后会告诉内核说：“内核君，我这有个包，快来拿”。内核于是就会去取这个包，既然是内核去取，那么这个包肯定到了内核后就要放到内存中的某个数据结构里了，这个数据结果对于内核来说就是sk_buff。所以我们可以认为此时这个sk_buff数据结构包含了这个数据包的所有内容。内核得到了这个sk_buff后，接下来做的事情就是让它走协议栈，我们就把协议栈当成是一个有7层楼的大厦，sk_buff是一个携带了传单想要在楼顶散发传单的小人好了。于是sk_buff这个小人就开始爬大厦，可能它能一直爬过所有楼层爬到楼顶，也可能在某一层就因为迷路或者找错大厦之类的原因被原路返回（也就是要下楼了）或者因为非法发传单而被捕了。在它爬楼的过程中每一层楼的楼管都会对其要发的传单做些标注或修改，但不论怎样传单在小人爬到楼顶散发前都是属于这个小人的，如果某层的某个居民想了解传单的内容，那么必须去找这个小人了解。所以可以看到，sk_buff就是我们的数据包在从数据包到达内核以及这个包最终到达上层之间唯一拥有这个数据包内容的结构体。其包含了网卡收到的数据包的全部信息以及协议栈对这个数据包做出的相关附加信息。

