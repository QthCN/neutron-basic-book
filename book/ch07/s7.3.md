## Kubernetes

在本章的一开始笔者提到基于容器提供一个PaaS是一个比较合适的方案，实际上目前一些大型厂商的PaaS服务就是基于类似容器的技术来提供的，而不是叠加在IaaS对外提供。当然笔者这里不讨论这样做是否合适。如果要基于容器提供PaaS服务那么必然要有一个调度控制器来管理我们的容器。目前Google的Kubernetes就是一个这样的平台。这里我们来讲一下这个Kubernetes。

Kubernetes笔者个人倾向于其是一个任务调度系统。比如一个WEB应用运行在Tomcat上，现在这个应用要上线了，在Kubernetes中的做法就是将这个WEB应用及Tomcat等先做成一个容器，然后在Kubernetes里写好这个应用的一些描述。接着通过Kubernetes的指令在一个集群中启动这个应用。使用者只要关心在容器中启动应用即可，Kubernetes会的根据描述信息自动的在集群中找到合适的物理机，然后在上面下载容器镜像并启动容器。一般为了高可用我们可以在描述信息中描述好副本个数，比如我们指定这个应用可以存在三个副本，则我们在启动应用的时候Kubernetes会的在集群中启动三个相同的应用，同时Kubernetes中存在一个Service的概念，对这个概念最简单的理解就是可以把它当成一个负载均衡器，外界来访问我们的WEB应用的时候看到的是Service的地址。当集群中运行应用容器的主机异常或宕机的时候，Service会的帮我们屏蔽这种异常。同时Kubernetes会根据副本个数保证集群中始终维持要求的副本个数。

在Kubernetes中，上面讲到的应用在其术语中称为Pod。大家可以认为一个Pod就是一个独立、完全的集合体，比如我们的应用是MySQL+Apache+PHP，那么在一个Pod中可以运行一个MySQL的容器以及一个Apache+PHP的容器，然后对外提供服务的时候一个Pod就够了，不需要额外的其它容器了。

对于Kubernetes的网络是比较值得研究的一个话题。Docker由于目前局限在单物理机的状态，所以其网络并不是非常复杂。但对于Kubernetes来说由于是一个集群，因此Pod与Pod之间、Pod与外界之间的网络就必须要做到足够的强大才能满足业务的支撑。在Kubernetes中一个Pod拥有一个独立的IP，在这个Pod中的所有容器都直接使用这个IP而不需要走NAT，因此Pod中的容器看到的自身IP就是外界看到的这个容器的IP。这样做的好处是对以前运行在虚拟机环境的业务能非常容易的进行迁移。比如我们上面的MySQL+Apache+PHP的例子，在传统虚拟化里一般是启动一台虚拟机然后上面分别运行MySQL以及Apache进程，这些进程监听的IP就是虚拟机的IP。此时将这一套迁移到Pod的时候网络方面就简单很多。当Pod需要和外界进行交互的时候Kubernetes目前有很多方案，按照刚刚说的例子这里大家可以把Pod想成我们的Nova虚拟机，这样大家就可以用Neutron的思想来套Kubernetes的网络方案了。比如复杂一点的，Pod中的数据流出来后接一个OVS，然后OVS打上vxlan头发送出去。

关于Kubernetes就介绍这么多。笔者个人认为对于希望从事大规模的集群运维的读者来说，熟悉Kubernetes这类调度控制平台的设计思想要比熟悉Docker这类容器技术重要的多。